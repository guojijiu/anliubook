### 优化

1. sql执行流程

```
1). 管理连接，权限验证：
    客户端发送sql请求，建立通讯连接（连接方式参考mysql-碎片知识：客户端与服务端的通讯方式）；
    确认通信方式并且成功建立连接之后，连接器验证你的身份；
2). 解析与优化：
        查询缓存：
            MySQL收到查询请求之后应该先到缓存中查看一下，看一下之前是不是执行过这条指令。如果缓存命中，则直接返回结果；否则重新进行查询，然后加入缓存；
        词法解析：
            分析器先会做“词法分析”，就是把一条完整的SQL语句打碎成一个个单词，比如一条简单的SQL语句，会打碎成8个符号，每个符号是什么类型，从哪里开始到哪里结束；
        语法分析：
            根据词法分析的结果，语法分析器会根据语法规则，判断你输入的这个 SQL 语句是否满足 MySQL 语法，比如单引号是否闭合，关键词拼写是否正确等，解析器会根据SQL语句生成一个数据结构，这个数据结构我们成为解析树；
        预处理器：
            会检查生成的解析树，解决解析器无法解析的语义。比如，它会检查表和列名是否存在，检查名字和别名，保证没有歧义。预处理之后得到一个新的解析树；
3). 查询优化器与查询执行计划：
        查询优化器：
            根据解析树生成不同的执行计划（Execution Plan），然后选择一种最优的执行计划，MySQL 里面使用的是基于开销（cost）的优化器，哪种执行计划开销最小，就用哪种；
        执行计划：
            优化器最终会把解析树变成一个查询执行计划，它展示了接下来执行查询的具体方式，比如多张表关联查询，先查询哪张表，在执行查询的时候有多个索引可以使用，实际上该使用哪些索引，在 SQL语句前面加上 EXPLAIN就可以看到执行计划的信息；
4). 存储引擎：
        存储引擎：
            接受上层指令，然后对表中数据进行读取和写入，而这些操作对上层完全是屏蔽的；
5). 返回结果；
```

2. sql优化

```
1). 避免使用select *
2). 用union all 代替union
3). 小表驱动大表；
4). 批量操作：减少数据库连接；
5). 多用limit；
6). int中值太多；
7). 增量查询；
8). 高效的分页；
9). 用连接查询代替子查询；
10). join的表不宜过多；
11). join时要注意；
12). 控制索引的数量；
13). 选择合理的字段类型；
14). 提升group by的效率；
15). 索引优化；
```

3. 整体优化

```
1). 连接配置优化：
    a. 增加连接数，
    b. 减小客户端超时时间；
2). 架构优化：
    a. 对于实时性不高的数据，使用缓存；
    b. 使用读写分离；
    c. 分库分表；
    d. 消息队列削峰；
3). sql分析与优化；
    a. 开启慢查询；
    b. 查看运行中的线程（show full processlist）；
    c. 查看存储引擎信息（SHOW ENGINE INNODB STATUS）；
    d. explain执行计划；
    e. sql优化；
    f. 索引优化；
4). 存储引擎与表结构：
    a. 选择合适的存储引擎；
    b. 字段优化；
5). 业务优化；

参考：https://juejin.cn/post/7083269706232102925#comment
```
