### 索引

1. 什么是索引？

```
建立数据库的数据的 “目录” ，按照目录直接锁定数据可能存在的范围，提升了查询的效率，这个 “目录” ，就是索引；
简单来说，索引就是一种提升了对于表操作效率的数据结构；
```

2. 索引失效

```
不满足最左匹配原则：从左往右匹配；；
使用了select *：查询所有列的数据，大概率会查询非索引列的数据，非索引列不会走索引，查询效率非常低。；
索引列上有计算；
索引列使用了函数；
字段类型不同；
like左边包含了%；
列对比；
使用or关键字；
not in和not exists；
order by的坑；
```

3. 聚簇索引和非聚簇索引

```
我们日常所说的主键索引，其实就是聚簇索引（Clustered Index）;主键索引之外，其他的都称之为非主键索引，非主键索引也被称为二级索引（Secondary Index），或者叫作辅助索引。
区别：
聚簇索引的叶子结点存储的是一行完整的数据，即这条数据的所有字段信息。
非聚簇索引的叶子结点存储的则是主键喝索引列信息。
```

4. 创建索引需要注意什么？

```
1. 区分度不大的情况，不宜建立索引，例如，某一列的值只存在1和2的情况；
2. 更新频繁的字段，不宜建立索引，如果索引的值发生变化，不仅主键索引指向的数据要修改，对应的B+树索引也会引发较多的数据来维持索引树的有序性和平衡性；
```

5. B-Tree和B+Tree的区别

```
B-Tree 中，所有节点都会带有指向具体记录的指针；B+Tree 中只有叶子结点会带有指向具体记录的指针。
B-Tree 中不同的叶子之间没有连在一起；B+Tree 中所有的叶子结点通过指针连接在一起。
B-Tree 中可能在非叶子结点就拿到了指向具体记录的指针，搜索效率不稳定；B+Tree 中，一定要到叶子结点中才可以获取到具体记录的指针，搜索效率稳定。
```

6. 回表

```
用非主键索引字段去搜索，拿到主键值后再去搜索主键索引，这个过程就是所谓的回表。
```

7. B+Tree的特点

```
1. 是多叉而不是二叉了，使用多叉的目的是降低树的高度;
2. 每个节点不再只是存储一个key了，可以存储多个key；
3. 非叶子节点存储key，叶子节点存储key和数据。
4. 叶子节点两两相连，为顺序查询提供了帮助
```

8. Mysql为什么选择B+树

```
1. B+树的非叶子节点只是存储key，占用空间非常小，因此每一层的节点能索引到的数据范围更加的广。换句话说，每次IO操作可以观看更多的数据；
2. 叶子节点两两相连，符合磁盘的预读特性。这个时候属于顺序读取，而不是磁盘寻道了，加快了速度。
3. 支持范围查询，而且部分范围查询非常高效，原因是数据都是存储在叶子节点这一层，并且有指针指向其他叶子节点，这样范围查询只需要遍历叶子节点这一层，无需整棵树遍历。
```

9. explain
```
1). jd（select唯一标识）
2). select_type（select类型）
常用类型：
SIMPLE：简单select查询，不包含子查询和union
PRIMARY：复杂查询中的最外层查询，表示主要的查询
SUBQUERY：select或where列表中包含了子查询
DERIVED：from列表中包含的子查询，即衍生
UNION：union关键字之后的查询
UNION RESULT：从UNION后的表获取结果集
3). table（表名称）
4). partitions（匹配的分区）
5). type（连接类型）
6). possible_keys（可能的索引选择）
7). key（实际用到的索引）
system > const > eq_ref > ref > range > index > ALL
system：这种类型要求数据库表中只有一条数据，是const类型的一个特例，一般情况下是不会出现的；
const：通过一次索引就能找到数据，一般用于主键或唯一索引作为条件的查询sql中；
eq_ref：常用于主键或唯一索引扫描；
ref：常用于非主键和唯一索引扫描；
range：常用于范围查询，比如：between ... and 或 In 等操作；
index：全索引扫描；
ALL：全表扫描；
8). key_len（实际索引长度）
9). ref（与索引比较的列）
10). rows（预计要检查的行数）
11). filtered（按表条件过滤的行百分比）
12). Extra（附加信息）
Impossible WHERE：表示WHERE后面的条件一直都是false；
Using filesort：表示按文件排序，一般是在指定的排序和索引排序不一致的情况才会出现；
Using index：表示是否用了覆盖索引，说白了它表示是否所有获取的列都走了索引；
Using temporary：表示是否使用了临时表，一般多见于order by 和 group by语句；
Using where：表示使用了where条件过滤；
Using join buffer：表示是否使用连接缓冲。来自较早联接的表被部分读取到联接缓冲区中，然后从缓冲区中使用它们的行来与当前表执行联接；
```

10. 覆盖索引
```
覆盖索引定义：MySQL 执行计划 explain 结果里的 key 有使用索引，如果 select 后面查询的字段都可以从这个索引的树中获取，这种情况一般可以说是用到了覆盖索引，extra 里一般都有 using index；覆盖索引一般针对的是辅助索引，整个査询结果只通过辅助索引就能拿到结果，不需要通过辅助索引树找到主键，再通过主键去主键索引树里获取其它字段值。

1.覆盖索引是一种数据查询方式，不是索引类型
2.在索引数据结构中，通过索引值可以直接找到要查询字段的值，而不需要通过主键值回表查询，那么就叫覆盖索引
3.查询的字段被使用到的索引树全部覆盖到
```